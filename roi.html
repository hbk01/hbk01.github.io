<!DOCTYPE html>
<html lang="zh_CN">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>炽灼残渣</title>
    <link rel="stylesheet" href="./github.css">
    <link rel="stylesheet" href="./theme.css">
    <script src="./decimal.js"></script>
    <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
        var debug = false;
        var tip = "<br>" +
            "操作过程：" +
            "<br>" +
            "空坩埚 -> 灼烧3小时 -> 冷却称重(1) -> 灼烧0.5小时 -> 冷却称重(2-1) -> 加样(2-2) -> 烧至无烟 -> 灼烧1小时 -> 冷却称重(3) -> 灼烧0.5小时 -> 冷却称重(4)" +
            "<br>" +
            "<br>" +
            "m0=恒重后空坩埚重（2-1）<br>" +
            "m1=样品重（2-2）<br>" +
            "m3=灼烧恒重后带样品重（4）";

        var decimal = Decimal.set(
            {
                rounding: Decimal.ROUND_HALF_EVEN,
                precision: 12
            }
        );


        $(document).ready(function () {
            var input_m0l = document.getElementById("m0l");
            var input_m1l = document.getElementById("m1l");
            var input_m3l = document.getElementById("m3l");
            var input_m0r = document.getElementById("m0r");
            var input_m1r = document.getElementById("m1r");
            var input_m3r = document.getElementById("m3r");

            $(".msgbox").append(tip)

            $("#ok").click(function () {
                var m0l = input_m0l.value;
                var m1l = input_m1l.value;
                var m3l = input_m3l.value;

                var m0r = input_m0r.value;
                var m1r = input_m1r.value;
                var m3r = input_m3r.value;

                var lod1 = lod(m0l, m1l, m3l)
                var lod2 = lod(m0r, m1r, m3r)
                var average = decimal.add(lod1, lod2).div(2).toString();

                var msg = "<br>" +
                    "第一组炽灼残渣 = " + lod1 + "<br>" +
                    "第二组炽灼残渣 = " + lod2 + "<br>" +
                    "两组炽灼残渣平均值 = " + average + "<br>";

                if (m0l != '' && m1l != '') {
                    msg += "第一组恒重后空坩埚+样 = " + decimal.add(m0l, m1l).toString() + "<br>";
                }

                if (m0r != '' && m1r != '') {
                    msg += "第二组恒重后空坩埚+样 = " + decimal.add(m0r, m1r).toString() + "<br>";
                }

                message(msg);
            });

            $("#clear").click(function () {
                var confirm = window.confirm("所填写的数据将被清空，确定？");
                if (!confirm) {
                    return;
                }
                input_m0l.value = "";
                input_m1l.value = "";
                input_m3l.value = "";
                input_m0r.value = "";
                input_m1r.value = "";
                input_m3r.value = "";

                message(tip);
            });

            $("#new_page").click(function () {
                window.open(window.location.href, "_blank");
            });

            if (debug) {
                document.getElementById("m0l").value = 18.34625;
                document.getElementById("m1l").value = 1.04213;
                document.getElementById("m3l").value = 19.38511;
            }
        });

        function message(msg) {
            $(".msgbox").empty();
            $(".msgbox").append(msg);
        }

        /**
         * 计算炽灼残渣
         * @param m0 恒重后空坩埚重
         * @param m1 样品重
         * @param m3 干燥恒重后带样品重
         * @return 炽灼残渣（%）
         */
        function lod(m0, m1, m3) {
            if (checkNull(m0, m1, m3)) {
                return "0";
            }

            var a = new Decimal(m0);
            var b = new Decimal(m1);
            var c = new Decimal(m3);

            // m3 - m0 / m1 * 100
            var d = decimal.sub(c, a)
            var e = d.div(b).mul(100);
            return e.toString();
        }

        function checkNull(m0, m1, m3) {
            return m0 == '' || m1 == '' || m3 == '';
        }

    </script>
</head>

<body>
    <h3>炽灼残渣</h3>
    <input type="text" name="lod-name" id="lod-name" placeholder="样品批号"><br><br>

    <div class="one-team">
        第一组<br>
        <input type="number" name="m0l" id="m0l" class="one-input m0" placeholder="m0" inputmode="decimal"><br>
        <input type="number" name="m1l" id="m1l" class="one-input m1" placeholder="m1" inputmode="decimal"><br>
        <input type="number" name="m3l" id="m3l" class="one-input m3" placeholder="m3" inputmode="decimal"><br>
        <br>
    </div>

    <div class="two-team">
        第二组<br>
        <input type="number" name="m0r" id="m0r" class="two-input m0" placeholder="m0" inputmode="decimal"><br>
        <input type="number" name="m1r" id="m1r" class="two-input m1" placeholder="m1" inputmode="decimal"><br>
        <input type="number" name="m3r" id="m3r" class="two-input m3" placeholder="m3" inputmode="decimal"><br>
        <br>
    </div>

    <div class="buttons">
        <button id="new_page">新开标签页</button>
        <button id="clear">清除内容</button>
        <button id="ok">计算</button>
    </div>

    <div class="msgbox"></div>

</body>

</html>
