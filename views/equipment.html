<!DOCTYPE html>
<html lang="zh-cmn-Hans">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>设备信息</title>
    <link rel="stylesheet" href="../statics/github.css">
    <link rel="stylesheet" href="../statics/theme.css">
    <style>
        .expir30 {
            color: darkorange;
        }

        .expir7 {
            color: red;
        }

        .expired {
            color: red;
            text-decoration: line-through;
        }

        .pure-table {
            width: 100%;
            font-size: small;
        }

        .pure-table caption {
            font-style: normal;
        }

    </style>
    <script src="../statics/modules/jquery.min.js"></script>
    <script src="./equipment.info.js"></script>
    <script>
        $(document).ready(() => {
            createTable(info)

            $("#search").click(() => {
                let keyword = $("#keyword").val()
                if (keyword == "") {
                    createTable(info)
                    return
                }
                let temp = []
                info.filter(value => {
                    if (value.id.toLowerCase().includes(keyword.toLowerCase()) ||
                        value.name.includes(keyword) ||
                        value.where.includes(keyword) ||
                        value.expir.includes(keyword)) {
                        temp.push(value)
                    }
                })

                createTable(temp)
            })
        })

        // 根据data创建表格
        function createTable(data) {
            let content = document.getElementById("content")
            content.innerHTML = ""
            let table = document.createElement("table")
            table.setAttribute("class", "pure-table")

            let caption = document.createElement("caption")
            caption.innerText = `共找到 ${data.length} 条记录`
            table.appendChild(caption)

            // add header
            let tr = document.createElement("tr")
            let th_where = document.createElement("th")
            let th_name = document.createElement("th")
            let th_id = document.createElement("th")
            let th_expir = document.createElement("th")

            th_where.innerText = "位置"
            th_name.innerText = "名称"
            th_id.innerText = "编号"
            th_expir.innerText = "有效期至"
            tr.appendChild(th_where)
            tr.appendChild(th_name)
            tr.appendChild(th_id)
            tr.appendChild(th_expir)
            table.appendChild(tr)

            // add contents
            data.forEach((value) => {
                let tr = document.createElement("tr")
                let td_where = document.createElement("td")
                let td_name = document.createElement("td")
                let td_id = document.createElement("td")
                let td_expir = document.createElement("td")

                td_where.innerText = value.where
                td_name.innerText = value.name
                td_id.innerText = value.id
                td_expir.innerHTML = expir(value.expir)

                tr.appendChild(td_where)
                tr.appendChild(td_name)
                tr.appendChild(td_id)
                tr.appendChild(td_expir)
                table.appendChild(tr)
            })

            content.appendChild(table)
        }

        // 设置日期样式
        function expir(value) {
            let date = new Date()
            let array = value.split(".")
            date.setFullYear(array[0], array[1] - 1, array[2])

            let day = (date - Date.now()) / 86400000

            if (day <= 0) {
                return `<span class='expired'>${value}</span>`
            }

            if (day <= 7) {
                return `<span class='expir7'>${value}</span>`
            }

            if (day <= 30) {
                return `<span class='expir30'>${value}</span>`
            }

            return value
        }
    </script>
</head>

<body>
    <div style="width: 100%; white-space: nowrap;">
        <input style="width: 80%;" type="text" id="keyword" placeholder="输入查询关键字（忽略大小写）">
        <button style="width: 15%;" id="search" type="submit">搜索</button>
    </div>
    <div id="content"></div>
    <p>
        过期提醒：<br>
        <span class="expir30">黄色表示有效期剩余30天</span><br>
        <span class="expir7">红色表示有效期剩余7天</span><br>
        <span class="expired">红色加删除线表示已过期</span><br>
    </p>
</body>

</html>
